import sys

from PySide6.QtCore import Qt
from PySide6.QtWidgets import (
    QAbstractItemView,
    QApplication,
    QFormLayout,
    QHBoxLayout,
    QLineEdit,
    QListWidget,
    QListWidgetItem,
    QMainWindow,
    QPlainTextEdit,
    QPushButton,
    QSplitter,
    QVBoxLayout,
    QWidget,
)

from contacts import sample_data


class MainWindow(QMainWindow):
    def __init__(self, parent=None):
        super().__init__(parent)
        self._contacts = sample_data.get_samples()
        splitter = QSplitter()
        self._list = self._create_list()
        splitter.addWidget(self._list)
        splitter.addWidget(self._create_form())
        self.setCentralWidget(splitter)

    def _create_list(self):
        list = QListWidget()
        list.setSelectionMode(QAbstractItemView.SelectionMode.SingleSelection)
        for c in self._contacts:
            item = QListWidgetItem()
            item.setText(c.name)
            item.setData(Qt.ItemDataRole.UserRole, c)
            list.addItem(item)
        list.itemSelectionChanged.connect(self._list_item_selection_changed)
        return list

    def _create_form(self):
        form_widget = QWidget()
        form_layout = QFormLayout()
        self._name_edit = QLineEdit()
        form_layout.addRow("Name", self._name_edit)
        self._address_edit = QPlainTextEdit()
        form_layout.addRow("Address", self._address_edit)
        self._phone_edit = QLineEdit()
        form_layout.addRow("Phone", self._phone_edit)
        self._email_edit = QLineEdit()
        form_layout.addRow("Email", self._email_edit)

        save_button = QPushButton("Save")
        save_button.clicked.connect(self._save_button_clicked)
        cancel_button = QPushButton("Cancel")
        cancel_button.clicked.connect(self._cancel_button_clicked)

        hbox = QHBoxLayout()
        hbox.addWidget(save_button)
        hbox.addWidget(cancel_button)

        vbox = QVBoxLayout()
        vbox.addLayout(form_layout)
        vbox.addLayout(hbox)

        form_widget.setLayout(vbox)
        return form_widget

    def _save_button_clicked(self):
        pass  # TBD

    def _cancel_button_clicked(self):
        self._list_item_selection_changed()

    def _list_item_selection_changed(self):
        selection = self._list.selectedItems()
        print(f"selection: {selection}")
        if len(selection) == 0:
            self._clear_form()
            return
        if len(selection) != 1:
            raise ValueError("Bug: selection size should always be zero or 1!")
        item = selection[0].data(Qt.ItemDataRole.UserRole)
        self._name_edit.setText(item.name)
        self._address_edit.setPlainText(item.address)
        self._phone_edit.setText(item.phone)
        self._email_edit.setText(item.email)

    def _clear_form(self):
        self._name_edit.clear()
        self._address_edit.clear()
        self._phone_edit.clear()
        self._email_edit.clear()


def main():
    app = QApplication(sys.argv)
    main_window = MainWindow()
    main_window.show()
    sys.exit(app.exec())


if __name__ == "__main__":
    main()
